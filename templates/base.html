<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>COT Freight Optimization Tool v1</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  </head>
  <body class="{% if show_nav is defined and not show_nav %}no-nav{% endif %}">
    <div class="app-shell{% if show_nav is defined and not show_nav %} shell-no-nav{% endif %}">
      {% if show_nav is not defined or show_nav %}
        <aside class="sidebar" data-sidebar>
          <div class="sidebar-header">
            <div class="sidebar-brand">
              <span class="material-symbols-outlined">local_shipping</span>
              <div class="brand-text">
                <span class="brand-title">Load Planner</span>
                <span class="brand-subtitle">Optimization Suite</span>
              </div>
            </div>
            <button class="sidebar-toggle" type="button" data-sidebar-toggle aria-label="Toggle sidebar">
              <span class="material-symbols-outlined">menu_open</span>
            </button>
          </div>
          <nav class="sidebar-nav">
            <div class="nav-section">
              <div class="nav-section-label">Planning</div>
              <a class="nav-item{% if request.path.startswith('/dashboard') or request.path == '/' %} active{% endif %}" href="{{ url_for('dashboard') }}">
                <span class="material-symbols-outlined nav-icon">dashboard</span>
                <span class="nav-text">Dashboard</span>
              </a>
              <a class="nav-item{% if request.path.startswith('/orders') %} active{% endif %}" href="{{ url_for('orders') }}">
                <span class="material-symbols-outlined nav-icon">list_alt</span>
                <span class="nav-text">Orders</span>
              </a>
              <a class="nav-item{% if request.path.startswith('/loads') %} active{% endif %}" href="{{ url_for('loads') }}">
                <span class="material-symbols-outlined nav-icon">local_shipping</span>
                <span class="nav-text">Loads</span>
              </a>
              <a class="nav-item{% if request.path.startswith('/feedback') %} active{% endif %}" href="{{ url_for('feedback_log') }}">
                <span class="material-symbols-outlined nav-icon">comment</span>
                <span class="nav-text">Feedback Log</span>
              </a>
            </div>
            <div class="nav-section">
              <div class="nav-section-label">Reporting</div>
              <a class="nav-item{% if request.path.startswith('/settings') %} active{% endif %}" href="{{ url_for('settings') }}">
                <span class="material-symbols-outlined nav-icon">tune</span>
                <span class="nav-text">Settings</span>
              </a>
            </div>
          </nav>
          <div class="sidebar-footer">
            {% if session_role %}
              {% set profile_display = session_profile_name or (session_role | title) %}
              {% set initials = profile_display[:1] | upper %}
              <details class="profile-menu">
                <summary class="profile-summary" aria-label="Open profile menu">
                  <div class="profile-card">
                    <div class="profile-avatar">{{ initials }}</div>
                    <div class="profile-meta">
                      <div class="profile-name">{{ profile_display }}</div>
                      <div class="profile-subtitle">{{ session_plant_filter_label }}</div>
                    </div>
                  </div>
                </summary>
                <div class="profile-menu-panel">
                  <form method="post" action="{{ url_for('access_switch') }}">
                    <input type="hidden" name="next" value="{{ request.full_path.rstrip('?') }}">
                    <label class="profile-menu-label">
                      Profile
                      <select name="profile_id" onchange="this.form.submit()">
                        {% for profile in access_profiles %}
                          <option value="{{ profile.id }}" {% if session_profile_id == profile.id %}selected{% endif %}>
                            {{ profile.name }}
                          </option>
                        {% endfor %}
                      </select>
                    </label>
                  </form>
                  {% if is_admin %}
                    <a class="profile-menu-link" href="{{ url_for('access_manage') }}">Manage Profiles</a>
                  {% endif %}
                  <form method="get" action="{{ url_for('session_reset') }}">
                    <button class="profile-menu-link" type="submit">Reset Session</button>
                  </form>
                </div>
              </details>
            {% else %}
              <a class="nav-item" href="{{ url_for('session_setup') }}">
                <span class="material-symbols-outlined nav-icon">person</span>
                <span class="nav-text">Set Session</span>
              </a>
            {% endif %}
          </div>
        </aside>
      {% endif %}
      <div class="app-main">
        <main class="page{% if request.path.startswith('/orders') or request.path.startswith('/loads') %} page-full{% endif %}">
          {% block content %}{% endblock %}
        </main>
      </div>
    </div>
    <script>
      const sidebarToggle = document.querySelector('[data-sidebar-toggle]');
      if (sidebarToggle) {
        const storageKey = 'sidebar-collapsed';
        const applyCollapsed = (collapsed) => {
          document.body.classList.toggle('sidebar-collapsed', collapsed);
        };
        const saved = localStorage.getItem(storageKey);
        if (saved === 'true') {
          applyCollapsed(true);
        }
        sidebarToggle.addEventListener('click', () => {
          const next = !document.body.classList.contains('sidebar-collapsed');
          applyCollapsed(next);
          localStorage.setItem(storageKey, next ? 'true' : 'false');
        });
      }
    </script>
  </body>
</html>
